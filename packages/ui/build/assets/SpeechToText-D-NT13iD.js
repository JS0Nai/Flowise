import{P as w,a as h,j as e,D as q,b as z,c as V,d as H,u as T,aQ as X,B as C,aH as N,a7 as W,X as B,q as k,aP as I,k as F,l as A,T as E,O as _}from"./index-BfWzQ8Ph.js";import{O as M,D as G,B as b,a as v,F as K}from"./useApi-DNUtCWFw.js";import{u as D,I as R,c as S,S as Q}from"./useNotifier-DEurOnvN.js";import{c as O}from"./chatflows-BPz0sNS7.js";import{S as J}from"./CredentialListDialog-MT2gTD_L.js";import{C as Y}from"./CredentialInputHandler-Bzf0JwLE.js";import{a as U}from"./TooltipWithParser-GKHocS55.js";import{L as Z,a as P,I as ee}from"./Input-DU8dUV6c.js";import{D as te}from"./Dropdown-CU36pm9t.js";import{M as L}from"./Delete-DmkfIKE_.js";const se=({show:r,dialogProps:c,onCancel:p,onConfirm:u})=>{const a=document.getElementById("portal"),[i,n]=h.useState(""),[f,y]=h.useState(!1);h.useEffect(()=>{y(!!i)},[i]);const m=r?e.jsxs(q,{open:r,fullWidth:!0,maxWidth:"xs",onClose:p,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(z,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:c.title}),e.jsx(V,{children:e.jsx(M,{sx:{mt:1},id:"chatflow-name",type:"text",fullWidth:!0,placeholder:"My New Chatflow",value:i,onChange:l=>n(l.target.value)})}),e.jsxs(G,{children:[e.jsx(b,{onClick:p,children:c.cancelButtonName}),e.jsx(v,{disabled:!f,variant:"contained",onClick:()=>u(i),children:c.confirmButtonName})]})]}):null;return H.createPortal(m,a)};se.propTypes={show:w.bool,dialogProps:w.object,onCancel:w.func,onConfirm:w.func};const ae=({dialogProps:r})=>{const c=T();D();const p=(...t)=>c(F(...t)),u=(...t)=>c(A(...t)),[a,i]=h.useState([{prompt:""}]),[n,f]=h.useState({}),y=()=>{i([...a,{prompt:""}])},m=t=>{const s=[...a];s.splice(t,1),i(s)},l=(t,s)=>{const{name:o,value:d}=s.target,x=[...a];x[t][o]=d,i(x)},g=async()=>{try{let t={starterPrompts:{...a}};n.starterPrompts=t.starterPrompts;const s=await O.updateChatflow(r.chatflow.id,{chatbotConfig:JSON.stringify(n)});s.data&&(p({message:"Conversation Starter Prompts Saved",options:{key:new Date().getTime()+Math.random(),variant:"success",action:o=>e.jsx(b,{style:{color:"white"},onClick:()=>u(o),children:e.jsx(k,{})})}}),c({type:I,chatflow:s.data}))}catch(t){const s=t.response.data||`${t.response.status}: ${t.response.statusText}`;p({message:`Failed to save Conversation Starter Prompts: ${s}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:o=>e.jsx(b,{style:{color:"white"},onClick:()=>u(o),children:e.jsx(k,{})})}})}};return h.useEffect(()=>{if(r.chatflow&&r.chatflow.chatbotConfig)try{let t=JSON.parse(r.chatflow.chatbotConfig);if(f(t||{}),t.starterPrompts){let s=[];Object.getOwnPropertyNames(t.starterPrompts).forEach(o=>{t.starterPrompts[o]&&s.push(t.starterPrompts[o])}),i(s)}else i([{prompt:""}])}catch{i([{prompt:""}])}return()=>{}},[r]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"flex",flexDirection:"column",borderRadius:10,background:"#d8f3dc",padding:10},children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(X,{size:30,color:"#2d6a4f"}),e.jsx("span",{style:{color:"#2d6a4f",marginLeft:10,fontWeight:500},children:"Starter prompts will only be shown when there is no messages on the chat"})]})}),e.jsx(C,{sx:{"& > :not(style)":{m:1},pt:2},children:e.jsx(N,{children:a.map((t,s)=>e.jsxs("div",{style:{display:"flex",width:"100%"},children:[e.jsx(C,{sx:{width:"95%",mb:1},children:e.jsx(M,{sx:{width:"100%"},type:"text",onChange:o=>l(s,o),size:"small",value:t.prompt,name:"prompt",endAdornment:e.jsx(R,{position:"end",sx:{padding:"2px"},children:a.length>1&&e.jsx(S,{sx:{height:30,width:30},size:"small",color:"error",disabled:a.length===1,onClick:()=>m(s),edge:"end",children:e.jsx(W,{})})})},s)}),e.jsx(C,{sx:{width:"5%",mb:1},children:s===a.length-1&&e.jsx(S,{color:"primary",onClick:y,children:e.jsx(B,{})})})]},s))})}),e.jsx(v,{variant:"contained",onClick:g,children:"Save"})]})};ae.propTypes={show:w.bool,dialogProps:w.object,onCancel:w.func,onConfirm:w.func};const ne=({dialogProps:r})=>{const c=T();D();const p=(...l)=>c(F(...l)),u=(...l)=>c(A(...l)),[a,i]=h.useState(!1),[n,f]=h.useState({}),y=l=>{i(l)},m=async()=>{try{let l={chatFeedback:{status:a}};n.chatFeedback=l.chatFeedback;const g=await O.updateChatflow(r.chatflow.id,{chatbotConfig:JSON.stringify(n)});g.data&&(p({message:"Chat Feedback Settings Saved",options:{key:new Date().getTime()+Math.random(),variant:"success",action:t=>e.jsx(b,{style:{color:"white"},onClick:()=>u(t),children:e.jsx(k,{})})}}),c({type:I,chatflow:g.data}))}catch(l){const g=l.response.data||`${l.response.status}: ${l.response.statusText}`;p({message:`Failed to save Chat Feedback Settings: ${g}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:t=>e.jsx(b,{style:{color:"white"},onClick:()=>u(t),children:e.jsx(k,{})})}})}};return h.useEffect(()=>{if(r.chatflow&&r.chatflow.chatbotConfig){let l=JSON.parse(r.chatflow.chatbotConfig);f(l||{}),l.chatFeedback&&i(l.chatFeedback.status)}return()=>{}},[r]),e.jsxs(e.Fragment,{children:[e.jsx(C,{sx:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:e.jsx(J,{label:"Enable chat feedback",onChange:y,value:a})}),e.jsx(v,{style:{marginBottom:10,marginTop:10},variant:"contained",onClick:m,children:"Save"})]})};ne.propTypes={dialogProps:w.object};const oe=({dialogProps:r})=>{const c=T();D();const p=(...t)=>c(F(...t)),u=(...t)=>c(A(...t)),[a,i]=h.useState([""]),[n,f]=h.useState({}),y=()=>{i([...a,""])},m=t=>{const s=[...a];s.splice(t,1),i(s)},l=(t,s)=>{const{value:o}=s.target,d=[...a];d[t]=o,i(d)},g=async()=>{try{let t={allowedOrigins:[...a]};n.allowedOrigins=t.allowedOrigins;const s=await O.updateChatflow(r.chatflow.id,{chatbotConfig:JSON.stringify(n)});s.data&&(p({message:"Allowed Origins Saved",options:{key:new Date().getTime()+Math.random(),variant:"success",action:o=>e.jsx(b,{style:{color:"white"},onClick:()=>u(o),children:e.jsx(k,{})})}}),c({type:I,chatflow:s.data}))}catch(t){const s=t.response.data||`${t.response.status}: ${t.response.statusText}`;p({message:`Failed to save Allowed Origins: ${s}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:o=>e.jsx(b,{style:{color:"white"},onClick:()=>u(o),children:e.jsx(k,{})})}})}};return h.useEffect(()=>{if(r.chatflow&&r.chatflow.chatbotConfig)try{let t=JSON.parse(r.chatflow.chatbotConfig);if(f(t||{}),t.allowedOrigins){let s=[...t.allowedOrigins];i(s)}else i([""])}catch{i([""])}return()=>{}},[r]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:e.jsx("span",{children:"Your chatbot will only work when used from the following domains."})}),e.jsx(C,{sx:{"& > :not(style)":{m:1},pt:2},children:e.jsx(N,{children:a.map((t,s)=>e.jsxs("div",{style:{display:"flex",width:"100%"},children:[e.jsx(C,{sx:{width:"100%",mb:1},children:e.jsx(M,{sx:{width:"100%"},type:"text",onChange:o=>l(s,o),size:"small",value:t,name:"origin",endAdornment:e.jsx(R,{position:"end",sx:{padding:"2px"},children:a.length>1&&e.jsx(S,{sx:{height:30,width:30},size:"small",color:"error",disabled:a.length===1,onClick:()=>m(s),edge:"end",children:e.jsx(W,{})})})},s)}),e.jsx(C,{sx:{width:"5%",mb:1},children:s===a.length-1&&e.jsx(S,{color:"primary",onClick:y,children:e.jsx(B,{})})})]},s))})}),e.jsx(v,{variant:"contained",onClick:g,children:"Save"})]})};oe.propTypes={dialogProps:w.object};const re="data:image/svg+xml,%3csvg%20width='32'%20height='32'%20viewBox='0%200%2032%2032'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M14.9814%2025.2665C15.353%2026.2672%2016.0645%2027.1054%2016.9914%2027.6347C17.9183%2028.164%2019.0018%2028.3507%2020.0524%2028.1622C21.103%2027.9737%2022.054%2027.422%2022.7391%2026.6034C23.4242%2025.7849%2023.7998%2024.7517%2023.8004%2023.6842V17.5533C23.8004%2017.1909%2023.6043%2016.8569%2023.2879%2016.6802L15.9995%2012.6108'%20stroke='black'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M7.17701%2019.5848C6.49568%2020.4069%206.12505%2021.4424%206.12993%2022.5101C6.13481%2023.5779%206.51489%2024.6099%207.2037%2025.4258C7.89252%2026.2416%208.84622%2026.7893%209.89802%2026.9732C10.9498%2027.157%2012.0328%2026.9653%2012.9575%2026.4314L18.1044%2023.4263C18.4114%2023.247%2018.6002%2022.9182%2018.6002%2022.5627V14.106'%20stroke='black'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M8.19877%209.98459C6.39026%209.67775%204.57524%2010.4982%203.60403%2012.1806C3.00524%2013.2178%202.84295%2014.4504%203.15284%2015.6073C3.46273%2016.7642%204.21943%2017.7507%205.25652%2018.3498L10.3049%2021.3269C10.6109%2021.5074%2010.9898%2021.5119%2011.3001%2021.3388L18.6%2017.2655'%20stroke='black'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M17.0172%206.06585C16.6456%205.06522%2015.9342%204.227%2015.0072%203.6977C14.0803%203.1684%2012.9969%202.98168%2011.9462%203.17018C10.8956%203.35869%209.94464%203.91042%209.25954%204.72895C8.57444%205.54747%208.19879%206.58074%208.19824%207.64814V13.6575C8.19824%2014.0154%208.38951%2014.346%208.69977%2014.5244L15.9992%2018.7215'%20stroke='black'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M24.8216%2011.7476C25.5029%2010.9255%2025.8735%209.89004%2025.8687%208.8223C25.8638%207.75457%2025.4837%206.72253%2024.7949%205.90667C24.1061%205.09082%2023.1524%204.54308%2022.1006%204.35924C21.0488%204.17541%2019.9658%204.36718%2019.0411%204.90101L13.8942%207.90613C13.5872%208.08539%2013.3984%208.41418%2013.3984%208.76971V17.2265'%20stroke='black'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M23.7997%2021.2595C25.6082%2021.5663%2027.4232%2020.7459%2028.3944%2019.0635C28.9932%2018.0263%2029.1555%2016.7937%2028.8456%2015.6368C28.5357%2014.4799%2027.779%2013.4934%2026.7419%2012.8943L21.6409%209.91752C21.3316%209.73703%2020.9494%209.7357%2020.6388%209.91405L17.2696%2011.849L13.3984%2014.0723'%20stroke='black'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",ie="/assets/assemblyai-DgONwkn3.png",j={openAIWhisper:{label:"OpenAI Whisper",name:"openAIWhisper",icon:re,url:"https://platform.openai.com/docs/guides/speech-to-text",inputs:[{label:"Connect Credential",name:"credential",type:"credential",credentialNames:["openAIApi"]},{label:"Language",name:"language",type:"string",description:"The language of the input audio. Supplying the input language in ISO-639-1 format will improve accuracy and latency.",placeholder:"en",optional:!0},{label:"Prompt",name:"prompt",type:"string",rows:4,description:"An optional text to guide the model's style or continue a previous audio segment. The prompt should match the audio language.",optional:!0},{label:"Temperature",name:"temperature",type:"number",step:.1,description:"The sampling temperature, between 0 and 1. Higher values like 0.8 will make the output more random, while lower values like 0.2 will make it more focused and deterministic.",optional:!0}]},assemblyAiTranscribe:{label:"Assembly AI",name:"assemblyAiTranscribe",icon:ie,url:"https://www.assemblyai.com/",inputs:[{label:"Connect Credential",name:"credential",type:"credential",credentialNames:["assemblyAIApi"]}]}},le=({dialogProps:r})=>{var g;const c=T();D();const p=(...t)=>c(F(...t)),u=(...t)=>c(A(...t)),[a,i]=h.useState({}),[n,f]=h.useState("none"),y=async()=>{const t=m(!0,n,"status");try{const s=await O.updateChatflow(r.chatflow.id,{speechToText:JSON.stringify(t)});s.data&&(p({message:"Speech To Text Configuration Saved",options:{key:new Date().getTime()+Math.random(),variant:"success",action:o=>e.jsx(b,{style:{color:"white"},onClick:()=>u(o),children:e.jsx(k,{})})}}),c({type:I,chatflow:s.data}))}catch(s){const o=s.response.data||`${s.response.status}: ${s.response.statusText}`;p({message:`Failed to save Speech To Text Configuration: ${o}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:d=>e.jsx(b,{style:{color:"white"},onClick:()=>u(d),children:e.jsx(k,{})})}})}},m=(t,s,o)=>{let d={};return Object.prototype.hasOwnProperty.call(a,s)?d={...a}:d={...a,[s]:{}},d[s][o]=t,o==="status"&&t===!0&&Object.keys(j).forEach(x=>{const $=j[x];$.name!==s&&(d[$.name]={...a[$.name],status:!1})}),i(d),d},l=t=>{f(t.target.value)};return h.useEffect(()=>{if(r.chatflow&&r.chatflow.speechToText)try{const t=JSON.parse(r.chatflow.speechToText);let s="none";Object.keys(j).forEach(o=>{const d=t[o];d&&d.status&&(s=o)}),f(s),i(t)}catch(t){i({}),f("none"),console.error(t)}return()=>{i({}),f("none")}},[r]),e.jsxs(e.Fragment,{children:[e.jsxs(C,{fullWidth:!0,sx:{mb:1,display:"flex",flexDirection:"column",gap:1},children:[e.jsx(E,{variant:"h4",sx:{mb:1},children:"Providers"}),e.jsx(K,{fullWidth:!0,children:e.jsxs(Q,{value:n,onChange:l,children:[e.jsx(L,{value:"none",children:"None"}),e.jsx(L,{value:"openAIWhisper",children:"OpenAI Whisper"}),e.jsx(L,{value:"assemblyAiTranscribe",children:"Assembly AI"})]})})]}),n!=="none"&&e.jsxs(e.Fragment,{children:[e.jsxs(Z,{style:{padding:0,margin:0},alignItems:"center",children:[e.jsx(P,{children:e.jsx("div",{style:{width:50,height:50,borderRadius:"50%",backgroundColor:"white"},children:e.jsx("img",{style:{width:"100%",height:"100%",padding:10,objectFit:"contain"},alt:"AI",src:j[n].icon})})}),e.jsx(_,{sx:{ml:1},primary:j[n].label,secondary:e.jsx("a",{target:"_blank",rel:"noreferrer",href:j[n].url,children:j[n].url})})]}),j[n].inputs.map((t,s)=>{var o,d;return e.jsxs(C,{sx:{p:2},children:[e.jsx("div",{style:{display:"flex",flexDirection:"row"},children:e.jsxs(E,{children:[t.label,!t.optional&&e.jsx("span",{style:{color:"red"},children:" *"}),t.description&&e.jsx(U,{style:{marginLeft:10},title:t.description})]})}),t.type==="credential"&&e.jsx(Y,{data:(o=a[n])!=null&&o.credentialId?{credential:a[n].credentialId}:{},inputParam:t,onSelect:x=>m(x,n,"credentialId")},(d=a[n])==null?void 0:d.credentialId),t.type==="boolean"&&e.jsx(J,{onChange:x=>m(x,n,t.name),value:a[n]?a[n][t.name]:t.default??!1}),(t.type==="string"||t.type==="password"||t.type==="number")&&e.jsx(ee,{inputParam:t,onChange:x=>m(x,n,t.name),value:a[n]?a[n][t.name]:t.default??""}),t.type==="options"&&e.jsx(te,{name:t.name,options:t.options,onSelect:x=>m(x,n,t.name),value:a[n]?a[n][t.name]:t.default??"choose an option"})]},s)})]}),e.jsx(v,{style:{marginBottom:10,marginTop:10},disabled:n!=="none"&&!((g=a[n])!=null&&g.credentialId),variant:"contained",onClick:y,children:"Save"})]})};le.propTypes={dialogProps:w.object};export{oe as A,ne as C,ae as S,le as a,se as b};
