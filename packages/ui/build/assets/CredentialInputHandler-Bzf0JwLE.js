import{s as O,aD as E,P as i,E as z,a,j as t,B as F,T as I,b0 as R,F as M,a6 as $}from"./index-BfWzQ8Ph.js";import{c as T,A as k,C as V}from"./CredentialListDialog-MT2gTD_L.js";import{a as H,A as U}from"./Autocomplete-BBd9zFIQ.js";import{T as Y,c as q}from"./useNotifier-DEurOnvN.js";import{C as G}from"./Skeleton-DKrfqZzy.js";const J=O(E)({boxShadow:"0px 8px 10px -5px rgb(0 0 0 / 20%), 0px 16px 24px 2px rgb(0 0 0 / 14%), 0px 6px 30px 5px rgb(0 0 0 / 12%)",borderRadius:"10px",[`& .${H.listbox}`]:{boxSizing:"border-box","& ul":{padding:10,margin:10}}}),K=async({name:r,nodeData:s})=>{var l;const f=(l=s.inputParams.find(c=>c.name===r))==null?void 0:l.loadMethod,g=localStorage.getItem("username"),m=localStorage.getItem("password");return await R.post(`${M}/api/v1/node-load-method/${s.name}`,{...s,loadMethod:f},{auth:g&&m?{username:g,password:m}:void 0}).then(async function(c){return c.data}).catch(function(c){console.error(c)})},B=({name:r,nodeData:s,value:f,onSelect:g,isCreateNewOption:m,onCreateNew:x,credentialNames:l=[],disabled:c=!1,disableClearable:h=!1})=>{const D=z(e=>e.customization),[w,C]=a.useState(!1),[d,y]=a.useState([]),[u,S]=a.useState(!1),A=(e=[],o)=>e.find(p=>p.name===o),N=()=>"",P=[{label:"- Create New -",name:"-create-"}];let[j,v]=a.useState(f??"choose an option");const n=async()=>{try{let e="";l.length>1?e=l.join("&credentialName="):e=l[0];const o=await T.getCredentialsByName(e);if(o.data){const p=[];for(let b=0;b<o.data.length;b+=1){const L={label:o.data[b].name,name:o.data[b].id};p.push(L)}return p}}catch(e){console.error(e)}};return a.useEffect(()=>{S(!0),(async()=>(async()=>{let o=l.length?await n():await K({name:r,nodeData:s});y(m?[...o,...P]:[...o]),S(!1)})())()},[]),t.jsx(t.Fragment,{children:t.jsx(U,{id:r,disabled:c,disableClearable:h,size:"small",sx:{width:"100%"},open:w,onOpen:()=>{C(!0)},onClose:()=>{C(!1)},options:d,value:A(d,j)||N(),onChange:(e,o)=>{const p=o?o.name:"";m&&p==="-create-"?x():(v(p),g(p))},PopperComponent:J,loading:u,renderInput:e=>t.jsx(Y,{...e,value:j,InputProps:{...e.InputProps,endAdornment:t.jsxs(a.Fragment,{children:[u?t.jsx(G,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})}}),renderOption:(e,o)=>t.jsx(F,{component:"li",...e,children:t.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[t.jsx(I,{variant:"h5",children:o.label}),o.description&&t.jsx(I,{sx:{color:D.isDarkMode?"#9e9e9e":""},children:o.description})]})})})})};B.propTypes={name:i.string,nodeData:i.object,value:i.string,onSelect:i.func,onCreateNew:i.func,disabled:i.bool,credentialNames:i.array,disableClearable:i.bool,isCreateNewOption:i.bool};const Q=({inputParam:r,data:s,onSelect:f,disabled:g=!1})=>{const m=a.useRef(null),[x,l]=a.useState((s==null?void 0:s.credential)??""),[c,h]=a.useState(!1),[D,w]=a.useState({}),[C,d]=a.useState(!1),[y,u]=a.useState({}),[S,A]=a.useState(Date.now().toString()),N=n=>{u({type:"EDIT",cancelButtonName:"Cancel",confirmButtonName:"Save",credentialId:n}),d(!0)},P=async()=>{try{let n="";r.credentialNames.length>1?n=r.credentialNames.join("&"):n=r.credentialNames[0];const e=await T.getSpecificComponentCredential(n);if(e.data)if(Array.isArray(e.data)){const o={title:"Add New Credential",componentsCredentials:e.data};w(o),h(!0)}else{const o={type:"ADD",cancelButtonName:"Cancel",confirmButtonName:"Add",credentialComponent:e.data};u(o),d(!0)}}catch(n){console.error(n)}},j=(n="")=>{l(n),A(Date.now().toString()),u({}),d(!1),f(n)},v=n=>{h(!1),u({type:"ADD",cancelButtonName:"Cancel",confirmButtonName:"Add",credentialComponent:n}),d(!0)};return a.useEffect(()=>{l((s==null?void 0:s.credential)??"")},[s]),t.jsxs("div",{ref:m,children:[r&&t.jsx(t.Fragment,{children:r.type==="credential"&&t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{marginTop:10}}),t.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[t.jsx(B,{disabled:g,name:r.name,nodeData:s,value:x??"choose an option",isCreateNewOption:!0,credentialNames:r.credentialNames,onSelect:n=>{l(n),f(n)},onCreateNew:()=>P(r.name)}),x&&t.jsx(q,{title:"Edit",color:"primary",size:"small",onClick:()=>N(x),children:t.jsx($,{})})]},S)]})}),C&&t.jsx(k,{show:C,dialogProps:y,onCancel:()=>d(!1),onConfirm:j}),c&&t.jsx(V,{show:c,dialogProps:D,onCancel:()=>h(!1),onCredentialSelected:v})]})};Q.propTypes={inputParam:i.object,data:i.object,onSelect:i.func,disabled:i.bool};export{B as A,Q as C};
