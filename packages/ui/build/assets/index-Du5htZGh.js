import{s as te,m as p,t as K,n as se,P as r,j as e,p as je,v as be,w as ye,x as we,y as Te,T as y,C as Y,o as Ce,A as ke,E as ve,a as o,F as Se,M as Be,B as w,G as Q,I as Fe,R as Ie,N as Pe,J as De,K as Me,O as M,L as Ae}from"./index-BfWzQ8Ph.js";import{I as T}from"./ItemCard-pahKd4xc.js";import{T as Le,W as ze}from"./workflow_empty-DTm7oMfh.js";import{C as A,B as Ee,T as Oe}from"./ToolDialog-Cz8QW869.js";import{b as R,B as ae,u as Ge,T as X,F as L,O as z,S as Ne}from"./useApi-DNUtCWFw.js";import{T as Re,I as We,b as E,S as O}from"./useNotifier-DEurOnvN.js";import{B as Z}from"./ButtonGroup-CLQF0vSA.js";import{M as G}from"./Delete-DmkfIKE_.js";import{G as ee}from"./Skeleton-DKrfqZzy.js";import"./Autocomplete-BBd9zFIQ.js";import"./TooltipWithParser-GKHocS55.js";import"./CodeEditor-DGLnL6g5.js";const Ue=()=>R.get("/marketplaces/chatflows"),He=()=>R.get("/marketplaces/tools"),Ve=()=>R.get("/marketplaces/templates"),qe={getAllChatflowsMarketplaces:Ue,getAllToolsMarketplaces:He,getAllTemplatesFromMarketplaces:Ve},h=te(p)(({theme:n})=>({[`&.${K.head}`]:{backgroundColor:n.palette.common.black,color:n.palette.common.white},[`&.${K.body}`]:{fontSize:14}})),$e=te(se)(({theme:n})=>({"&:nth-of-type(odd)":{backgroundColor:n.palette.action.hover},"&:last-child td, &:last-child th":{border:0}})),le=({data:n,filterFunction:i,filterByBadge:C,filterByType:m,filterByFramework:k,goToCanvas:x,goToTool:v})=>{const S=a=>{a.flowData?x(a):v(a)};return e.jsx(e.Fragment,{children:e.jsx(je,{style:{marginTop:"30",border:1},component:be,children:e.jsxs(ye,{sx:{minWidth:650},size:"small","aria-label":"a dense table",children:[e.jsx(we,{children:e.jsxs(se,{sx:{marginTop:"10",backgroundColor:"primary"},children:[e.jsx(h,{component:"th",scope:"row",style:{width:"15%"},children:"Name"},"0"),e.jsx(h,{component:"th",scope:"row",style:{width:"5%"},children:"Type"},"1"),e.jsx(h,{style:{width:"35%"},children:"Description"},"2"),e.jsx(h,{style:{width:"35%"},children:"Nodes"},"3"),e.jsx(h,{component:"th",scope:"row",style:{width:"5%"},children:"Â "},"4")]})}),e.jsx(Te,{children:n.filter(C).filter(m).filter(i).filter(k).map((a,B)=>e.jsxs($e,{children:[e.jsx(p,{children:e.jsx(y,{sx:{fontSize:"1.2rem",fontWeight:500,overflowWrap:"break-word",whiteSpace:"pre-line"},children:e.jsx(ae,{onClick:()=>S(a),sx:{textAlign:"left"},children:a.templateName||a.name})})},"0"),e.jsx(p,{children:e.jsx(y,{children:a.type})},"1"),e.jsx(p,{children:e.jsx(y,{sx:{overflowWrap:"break-word",whiteSpace:"pre-line"},children:a.description||""})},"2"),e.jsx(p,{children:e.jsx("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap",marginTop:5},children:a.categories&&a.categories.split(",").map((c,l)=>e.jsx(Y,{variant:"outlined",size:"small",label:c.toUpperCase(),style:{marginRight:3,marginBottom:3}},l))})},"3"),e.jsx(p,{children:e.jsx(y,{children:a.badge&&a.badge.split(";").map((c,l)=>e.jsx(Y,{color:c==="POPULAR"?"primary":"error",size:"small",label:c.toUpperCase(),style:{marginRight:5,marginBottom:5}},l))})},"4")]},B))})]})})})};le.propTypes={data:r.array,filterFunction:r.func,filterByBadge:r.func,filterByType:r.func,filterByFramework:r.func,goToTool:r.func,goToCanvas:r.func};r.node,r.number.isRequired,r.number.isRequired;const _e=48,Je=8,Ke=["POPULAR","NEW"],Ye=["Chatflow","Tool"],Qe=["Langchain","LlamaIndex"],N={PaperProps:{style:{maxHeight:_e*4.5+Je,width:250}}},pt=()=>{var q,$;const n=Ce(),i=ke(),C=ve(t=>t.customization),[m,k]=o.useState(!0),[x,v]=o.useState({}),[S,a]=o.useState(!1),[B,c]=o.useState({}),l=Ge(qe.getAllTemplatesFromMarketplaces),[g,oe]=o.useState(localStorage.getItem("mpDisplayStyle")||"card"),[F,re]=o.useState(""),[u,ie]=o.useState([]),[f,ne]=o.useState([]),[j,ce]=o.useState([]),[b,de]=o.useState(!1),pe=t=>{const{target:{value:s}}=t;ie(typeof s=="string"?s.split(","):s)},me=t=>{const{target:{value:s}}=t;ne(typeof s=="string"?s.split(","):s)},he=t=>{const{target:{value:s}}=t;ce(typeof s=="string"?s.split(","):s)},xe=(t,s)=>{s!==null&&(localStorage.setItem("mpDisplayStyle",s),oe(s))},ge=t=>{re(t.target.value)};function W(t){var s;return((s=t.categories)==null?void 0:s.toLowerCase().indexOf(F.toLowerCase()))>-1||t.templateName.toLowerCase().indexOf(F.toLowerCase())>-1||t.description&&t.description.toLowerCase().indexOf(F.toLowerCase())>-1}function U(t){return u.length>0?u.includes(t.badge):!0}function H(t){return f.length>0?f.includes(t.type):!0}function V(t){return j.length>0?j.includes(t.framework):!0}const ue=t=>{c({title:"Add New Tool",type:"IMPORT",cancelButtonName:"Cancel",confirmButtonName:"Add",data:t}),a(!0)},I=t=>{const s={title:t.templateName,type:"TEMPLATE",data:t};c(s),a(!0)},P=t=>{n(`/marketplace/${t.id}`,{state:t})};return o.useEffect(()=>{l.request()},[]),o.useEffect(()=>{k(l.loading)},[l.loading]),o.useEffect(()=>{if(l.data)try{const t=l.data,s={};for(let d=0;d<t.length;d+=1)if(t[d].flowData){const fe=t[d].flowData,_=JSON.parse(fe).nodes||[];s[t[d].id]=[];for(let D=0;D<_.length;D+=1){const J=`${Se}/api/v1/node-icon/${_[D].data.name}`;s[t[d].id].includes(J)||s[t[d].id].push(J)}}v(s)}catch(t){console.error(t)}},[l.data]),e.jsxs(e.Fragment,{children:[e.jsxs(Be,{sx:{background:C.isDarkMode?i.palette.common.black:""},children:[e.jsx(w,{sx:{flexGrow:1},children:e.jsxs(Q,{disableGutters:!0,style:{margin:1,padding:1,paddingBottom:10,display:"flex",justifyContent:"space-between",width:"100%"},children:[e.jsx("h1",{children:"Marketplace"}),e.jsx(Re,{size:"small",id:"search-filter-textbox",sx:{display:{xs:"none",sm:"block"},ml:3},variant:"outlined",fullWidth:"true",placeholder:"Search name or description or node name",onChange:ge,InputProps:{startAdornment:e.jsx(We,{position:"start",children:e.jsx(Fe,{})})}}),e.jsx(ae,{sx:{width:"220px",ml:3,mr:5},variant:"outlined",onClick:()=>de(!b),startIcon:b?e.jsx(Ie,{}):e.jsx(Pe,{}),children:b?"Hide Filters":"Show Filters"}),e.jsx(w,{sx:{flexGrow:1}}),e.jsx(Z,{sx:{maxHeight:40},disableElevation:!0,variant:"contained","aria-label":"outlined primary button group",children:e.jsx(Z,{disableElevation:!0,variant:"contained","aria-label":"outlined primary button group",children:e.jsxs(Le,{sx:{maxHeight:40},value:g,color:"primary",exclusive:!0,onChange:xe,children:[e.jsx(X,{sx:{color:(q=i==null?void 0:i.customization)!=null&&q.isDarkMode?"white":"inherit"},variant:"contained",value:"card",title:"Card View",children:e.jsx(De,{})}),e.jsx(X,{sx:{color:($=i==null?void 0:i.customization)!=null&&$.isDarkMode?"white":"inherit"},variant:"contained",value:"list",title:"List View",children:e.jsx(Me,{})})]})})})]})}),b&&e.jsx(w,{sx:{flexGrow:1,mb:2},children:e.jsxs(Q,{disableGutters:!0,style:{margin:1,padding:1,paddingBottom:10,display:"flex",justifyContent:"flex-start",width:"100%",borderBottom:"1px solid"},children:[e.jsxs(L,{sx:{m:1,width:250},children:[e.jsx(E,{size:"small",id:"filter-badge-label",children:"Tag"}),e.jsx(O,{labelId:"filter-badge-label",id:"filter-badge-checkbox",size:"small",multiple:!0,value:u,onChange:pe,input:e.jsx(z,{label:"Badge"}),renderValue:t=>t.join(", "),MenuProps:N,children:Ke.map(t=>e.jsxs(G,{value:t,children:[e.jsx(A,{checked:u.indexOf(t)>-1}),e.jsx(M,{primary:t})]},t))})]}),e.jsxs(L,{sx:{m:1,width:250},children:[e.jsx(E,{size:"small",id:"type-badge-label",children:"Type"}),e.jsx(O,{size:"small",labelId:"type-badge-label",id:"type-badge-checkbox",multiple:!0,value:f,onChange:me,input:e.jsx(z,{label:"Badge"}),renderValue:t=>t.join(", "),MenuProps:N,children:Ye.map(t=>e.jsxs(G,{value:t,children:[e.jsx(A,{checked:f.indexOf(t)>-1}),e.jsx(M,{primary:t})]},t))})]}),e.jsxs(L,{sx:{m:1,width:250},children:[e.jsx(E,{size:"small",id:"type-fw-label",children:"Framework"}),e.jsx(O,{size:"small",labelId:"type-fw-label",id:"type-fw-checkbox",multiple:!0,value:j,onChange:he,input:e.jsx(z,{label:"Badge"}),renderValue:t=>t.join(", "),MenuProps:N,children:Qe.map(t=>e.jsxs(G,{value:t,children:[e.jsx(A,{checked:j.indexOf(t)>-1}),e.jsx(M,{primary:t})]},t))})]})]})}),!m&&(!g||g==="card")&&l.data&&e.jsx(e.Fragment,{children:e.jsx(ee,{container:!0,spacing:Ae,children:l.data.filter(U).filter(H).filter(W).filter(V).map((t,s)=>e.jsxs(ee,{item:!0,lg:3,md:4,sm:6,xs:12,children:[t.badge&&e.jsxs(Ee,{sx:{"& .MuiBadge-badge":{right:20}},badgeContent:t.badge,color:t.badge==="POPULAR"?"primary":"error",children:[t.type==="Chatflow"&&e.jsx(T,{onClick:()=>P(t),data:t,images:x[t.id]}),t.type==="Tool"&&e.jsx(T,{data:t,onClick:()=>I(t)})]}),!t.badge&&t.type==="Chatflow"&&e.jsx(T,{onClick:()=>P(t),data:t,images:x[t.id]}),!t.badge&&t.type==="Tool"&&e.jsx(T,{data:t,onClick:()=>I(t)})]},s))})}),!m&&g==="list"&&l.data&&e.jsx(le,{sx:{mt:20},data:l.data,filterFunction:W,filterByType:H,filterByBadge:U,filterByFramework:V,goToTool:I,goToCanvas:P}),!m&&(!l.data||l.data.length===0)&&e.jsxs(Ne,{sx:{alignItems:"center",justifyContent:"center"},flexDirection:"column",children:[e.jsx(w,{sx:{p:2,height:"auto"},children:e.jsx("img",{style:{objectFit:"cover",height:"30vh",width:"auto"},src:ze,alt:"WorkflowEmptySVG"})}),e.jsx("div",{children:"No Marketplace Yet"})]})]}),e.jsx(Oe,{show:S,dialogProps:B,onCancel:()=>a(!1),onConfirm:()=>a(!1),onUseTemplate:t=>ue(t)})]})};export{pt as default};
