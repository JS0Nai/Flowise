import{s as Se,aD as we,P as o,E as Ie,a as r,j as e,B as T,T as S,A as Ce,bm as Te,bR as ke,bS as Oe,D as oe,b as re,c as le,d as ce,u as Ne,S as $e,H as ne,q as C,k as Fe,l as Re}from"./index-BfWzQ8Ph.js";import{F as de,B as w,a as H,b as N,u as ae,S as O,O as K,D as Be}from"./useApi-DNUtCWFw.js";import{a as _}from"./TooltipWithParser-GKHocS55.js";import{D as Me}from"./Dropdown-CU36pm9t.js";import{a as Ee,A as Ue}from"./Autocomplete-BBd9zFIQ.js";import{T as Le,u as We,c as Je}from"./useNotifier-DEurOnvN.js";import{C as ze}from"./CredentialInputHandler-Bzf0JwLE.js";import{C as qe}from"./Skeleton-DKrfqZzy.js";let Q;const _e=new Uint8Array(16);function Ve(){if(!Q&&(Q=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Q))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Q(_e)}const h=[];for(let n=0;n<256;++n)h.push((n+256).toString(16).slice(1));function He(n,s=0){return h[n[s+0]]+h[n[s+1]]+h[n[s+2]]+h[n[s+3]]+"-"+h[n[s+4]]+h[n[s+5]]+"-"+h[n[s+6]]+h[n[s+7]]+"-"+h[n[s+8]]+h[n[s+9]]+"-"+h[n[s+10]]+h[n[s+11]]+h[n[s+12]]+h[n[s+13]]+h[n[s+14]]+h[n[s+15]]}const Ge=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ie={randomUUID:Ge};function V(n,s,p){if(ie.randomUUID&&!s&&!n)return ie.randomUUID();n=n||{};const x=n.random||(n.rng||Ve)();if(x[6]=x[6]&15|64,x[8]=x[8]&63|128,s){p=p||0;for(let j=0;j<16;++j)s[p+j]=x[j];return s}return He(x)}const Xe=Se(we)({boxShadow:"0px 8px 10px -5px rgb(0 0 0 / 20%), 0px 16px 24px 2px rgb(0 0 0 / 14%), 0px 6px 30px 5px rgb(0 0 0 / 12%)",borderRadius:"10px",[`& .${Ee.listbox}`]:{boxSizing:"border-box","& ul":{padding:10,margin:10}}}),pe=({name:n,value:s,options:p,onSelect:x,formControlSx:j={},disabled:y=!1,disableClearable:g=!1})=>{const b=Ie(l=>l.customization),u=(l=[],i)=>{let d=[];return i&&typeof i=="string"?d=JSON.parse(i):d=i,l.filter(c=>d.includes(c.name))},A=()=>[];let[D,f]=r.useState(s??[]);return e.jsx(de,{sx:{mt:1,width:"100%",...j},size:"small",children:e.jsx(Ue,{id:n,disabled:y,disableClearable:g,size:"small",multiple:!0,filterSelectedOptions:!0,options:p||[],value:u(p,D)||A(),onChange:(l,i)=>{let d="";if(i.length){const c=[];for(let I=0;I<i.length;I+=1)c.push(i[I].name);d=JSON.stringify(c)}f(d),x(d)},PopperComponent:Xe,renderInput:l=>e.jsx(Le,{...l,value:D}),renderOption:(l,i)=>e.jsx(T,{component:"li",...l,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsx(S,{variant:"h5",children:i.label}),i.description&&e.jsx(S,{sx:{color:b.isDarkMode?"#9e9e9e":""},children:i.description})]})})})})};pe.propTypes={name:o.string,value:o.string,options:o.array,onSelect:o.func,disabled:o.bool,formControlSx:o.object,disableClearable:o.bool};const ue=({value:n,fileType:s,onChange:p,disabled:x=!1})=>{const j=Ce(),[y,g]=r.useState(n??""),b=async u=>{if(u.target.files){if(u.target.files.length===1){const A=u.target.files[0],{name:D}=A,f=new FileReader;f.onload=l=>{var c;if(!((c=l==null?void 0:l.target)!=null&&c.result))return;const{result:i}=l.target,d=i+`,filename:${D}`;g(d),p(d)},f.readAsDataURL(A)}else if(u.target.files.length>0){let A=Array.from(u.target.files).map(f=>{const l=new FileReader,{name:i}=f;return new Promise(d=>{l.onload=c=>{var $;if(!(($=c==null?void 0:c.target)!=null&&$.result))return;const{result:I}=c.target,k=I+`,filename:${i}`;d(k)},l.readAsDataURL(f)})});const D=await Promise.all(A);g(JSON.stringify(D)),p(JSON.stringify(D))}}};return e.jsxs(de,{sx:{mt:1,width:"100%"},size:"small",children:[e.jsx("span",{style:{fontStyle:"italic",color:j.palette.grey[800],marginBottom:"1rem"},children:y?Te(y):"Choose a file to upload"}),e.jsxs(w,{disabled:x,variant:"outlined",component:"label",fullWidth:!0,startIcon:e.jsx(ke,{}),sx:{marginRight:"1rem"},children:["Upload File",e.jsx("input",{type:"file",multiple:!0,accept:s,hidden:!0,onChange:u=>b(u)})]})]})};ue.propTypes={value:o.string,fileType:o.string,onChange:o.func,disabled:o.bool};const me=({open:n})=>e.jsx("div",{children:e.jsx(Oe,{sx:{color:"#fff",zIndex:s=>s.zIndex.drawer+1},open:n,children:e.jsx(qe,{color:"inherit"})})});me.propTypes={open:o.bool};const he=({show:n,dialogProps:s,onCancel:p,onDelete:x,onDeleteBoth:j})=>{const y=document.getElementById("portal"),g=n?e.jsxs(oe,{fullWidth:!0,maxWidth:"xs",open:n,onClose:p,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(re,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:s.title}),e.jsxs(le,{children:[e.jsx("span",{children:s.description}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",marginTop:20},children:[e.jsx(H,{sx:{mb:1},color:"orange",variant:"contained",onClick:x,children:"Delete only from Flowise"}),e.jsx(H,{sx:{mb:1},color:"error",variant:"contained",onClick:j,children:"Delete from both OpenAI and Flowise"}),e.jsx(w,{onClick:p,children:s.cancelButtonName})]})]})]}):null;return ce.createPortal(g,y)};he.propTypes={show:o.bool,dialogProps:o.object,onDeleteBoth:o.func,onDelete:o.func,onCancel:o.func};const Ke=()=>N.get("/assistants"),Qe=n=>N.get(`/assistants/${n}`),Ye=(n,s)=>N.get(`/openai-assistants/${n}?credential=${s}`),Ze=n=>N.get(`/openai-assistants?credential=${n}`),Pe=n=>N.post("/assistants",n),et=(n,s)=>N.put(`/assistants/${n}`,s),tt=(n,s)=>s?N.delete(`/assistants/${n}?isDeleteBoth=true`):N.delete(`/assistants/${n}`),J={getAllAssistants:Ke,getSpecificAssistant:Qe,getAssistantObj:Ye,getAllAvailableAssistants:Ze,createNewAssistant:Pe,updateAssistant:et,deleteAssistant:tt},st=[{label:"gpt-4-1106-preview",name:"gpt-4-1106-preview"},{label:"gpt-4-0613",name:"gpt-4-0613"},{label:"gpt-4-0314",name:"gpt-4-0314"},{label:"gpt-4",name:"gpt-4"},{label:"gpt-3.5-turbo",name:"gpt-3.5-turbo"},{label:"gpt-3.5-turbo-1106",name:"gpt-3.5-turbo-1106"},{label:"gpt-3.5-turbo-0613",name:"gpt-3.5-turbo-0613"},{label:"gpt-3.5-turbo-16k",name:"gpt-3.5-turbo-16k"},{label:"gpt-3.5-turbo-16k-0613",name:"gpt-3.5-turbo-16k-0613"}],nt=({show:n,dialogProps:s,onCancel:p,onConfirm:x})=>{const j=document.getElementById("portal");We();const y=Ne(),g=(...t)=>y(Fe(...t)),b=(...t)=>y(Re(...t)),u=ae(J.getSpecificAssistant),A=ae(J.getAssistantObj),[D,f]=r.useState(""),[l,i]=r.useState(""),[d,c]=r.useState(""),[I,k]=r.useState(""),[$,B]=r.useState(`https://api.dicebear.com/7.x/bottts/svg?seed=${V()}`),[M,E]=r.useState(""),[F,U]=r.useState(""),[Y,L]=r.useState(""),[z,R]=r.useState(["code_interpreter","retrieval"]),[G,W]=r.useState([]),[X,Z]=r.useState(""),[ee,v]=r.useState(!1),[xe,P]=r.useState(!1),[ge,ye]=r.useState({});r.useEffect(()=>(y(n?{type:$e}:{type:ne}),()=>y({type:ne})),[n,y]),r.useEffect(()=>{if(u.data){f(u.data.id),B(u.data.iconSrc),U(u.data.credential);const t=JSON.parse(u.data.details);i(t.id),c(t.name),k(t.description),E(t.model),L(t.instructions),R(t.tools??[]),W(t.files??[])}},[u.data]),r.useEffect(()=>{A.data&&te(A.data)},[A.data]),r.useEffect(()=>{if(s.type==="EDIT"&&s.data){f(s.data.id),B(s.data.iconSrc),U(s.data.credential);const t=JSON.parse(s.data.details);i(t.id),c(t.name),k(t.description),E(t.model),L(t.instructions),R(t.tools??[]),W(t.files??[])}else s.type==="EDIT"&&s.assistantId?u.request(s.assistantId):s.type==="ADD"&&s.selectedOpenAIAssistantId&&s.credential?(f(""),B(`https://api.dicebear.com/7.x/bottts/svg?seed=${V()}`),U(s.credential),A.request(s.selectedOpenAIAssistantId,s.credential)):s.type==="ADD"&&!s.selectedOpenAIAssistantId&&(f(""),B(`https://api.dicebear.com/7.x/bottts/svg?seed=${V()}`),U(""),i(""),c(""),k(""),E(""),L(""),R(["code_interpreter","retrieval"]),Z(""),W([]));return()=>{f(""),B(`https://api.dicebear.com/7.x/bottts/svg?seed=${V()}`),U(""),i(""),c(""),k(""),E(""),L(""),R(["code_interpreter","retrieval"]),Z(""),W([]),v(!1)}},[s]);const te=t=>{i(t.id),c(t.name),k(t.description),E(t.model),L(t.instructions),W(t.files??[]);let a=[];if(t.tools&&t.tools.length)for(const m of t.tools)a.push(m.type);R(a)},fe=async()=>{v(!0);try{const a={details:JSON.stringify({id:l,name:d,description:I,model:M,instructions:Y,tools:z,files:G,uploadFiles:X}),iconSrc:$,credential:F},m=await J.createNewAssistant(a);m.data&&(g({message:"New Assistant added",options:{key:new Date().getTime()+Math.random(),variant:"success",action:q=>e.jsx(w,{style:{color:"white"},onClick:()=>b(q),children:e.jsx(C,{})})}}),x(m.data.id)),v(!1)}catch(t){const a=t.response.data||`${t.response.status}: ${t.response.statusText}`;g({message:`Failed to add new Assistant: ${a}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:m=>e.jsx(w,{style:{color:"white"},onClick:()=>b(m),children:e.jsx(C,{})})}}),v(!1),p()}},je=async()=>{v(!0);try{const a={details:JSON.stringify({name:d,description:I,model:M,instructions:Y,tools:z,files:G,uploadFiles:X}),iconSrc:$,credential:F},m=await J.updateAssistant(D,a);m.data&&(g({message:"Assistant saved",options:{key:new Date().getTime()+Math.random(),variant:"success",action:q=>e.jsx(w,{style:{color:"white"},onClick:()=>b(q),children:e.jsx(C,{})})}}),x(m.data.id)),v(!1)}catch(t){const a=t.response.data||`${t.response.status}: ${t.response.statusText}`;g({message:`Failed to save Assistant: ${a}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:m=>e.jsx(w,{style:{color:"white"},onClick:()=>b(m),children:e.jsx(C,{})})}}),v(!1),p()}},be=async()=>{v(!0);try{const t=await J.getAssistantObj(l,F);t.data&&(te(t.data),g({message:"Assistant successfully synced!",options:{key:new Date().getTime()+Math.random(),variant:"success",action:a=>e.jsx(w,{style:{color:"white"},onClick:()=>b(a),children:e.jsx(C,{})})}})),v(!1)}catch(t){const a=t.response.data||`${t.response.status}: ${t.response.statusText}`;g({message:`Failed to sync Assistant: ${a}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:m=>e.jsx(w,{style:{color:"white"},onClick:()=>b(m),children:e.jsx(C,{})})}}),v(!1)}},Ae=()=>{ye({title:"Delete Assistant",description:`Delete Assistant ${d}?`,cancelButtonName:"Cancel"}),P(!0)},se=async t=>{P(!1);try{(await J.deleteAssistant(D,t)).data&&(g({message:"Assistant deleted",options:{key:new Date().getTime()+Math.random(),variant:"success",action:m=>e.jsx(w,{style:{color:"white"},onClick:()=>b(m),children:e.jsx(C,{})})}}),x())}catch(a){const m=a.response.data||`${a.response.status}: ${a.response.statusText}`;g({message:`Failed to delete Assistant: ${m}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:q=>e.jsx(w,{style:{color:"white"},onClick:()=>b(q),children:e.jsx(C,{})})}}),p()}},De=async t=>{W(G.filter(a=>a.id!==t))},ve=n?e.jsxs(oe,{fullWidth:!0,maxWidth:"md",open:n,onClose:p,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(re,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:s.title}),e.jsxs(le,{children:[e.jsxs(T,{sx:{p:2},children:[e.jsx(O,{sx:{position:"relative"},direction:"row",children:e.jsxs(S,{variant:"overline",children:["Assistant Name",e.jsx(_,{style:{marginLeft:10},title:"The name of the assistant. The maximum length is 256 characters."})]})}),e.jsx(K,{id:"assistantName",type:"string",fullWidth:!0,placeholder:"My New Assistant",value:d,name:"assistantName",onChange:t=>c(t.target.value)})]}),e.jsxs(T,{sx:{p:2},children:[e.jsx(O,{sx:{position:"relative"},direction:"row",children:e.jsxs(S,{variant:"overline",children:["Assistant Description",e.jsx(_,{style:{marginLeft:10},title:"The description of the assistant. The maximum length is 512 characters."})]})}),e.jsx(K,{id:"assistantDesc",type:"string",fullWidth:!0,placeholder:"Description of what the Assistant does",multiline:!0,rows:3,value:I,name:"assistantDesc",onChange:t=>k(t.target.value)})]}),e.jsxs(T,{sx:{p:2},children:[e.jsx(O,{sx:{position:"relative"},direction:"row",children:e.jsx(S,{variant:"overline",children:"Assistant Icon Src"})}),e.jsx("div",{style:{width:100,height:100,borderRadius:"50%",backgroundColor:"white"},children:e.jsx("img",{style:{width:"100%",height:"100%",padding:5,borderRadius:"50%",objectFit:"contain"},alt:d,src:$})}),e.jsx(K,{id:"assistantIcon",type:"string",fullWidth:!0,placeholder:`https://api.dicebear.com/7.x/bottts/svg?seed=${V()}`,value:$,name:"assistantIcon",onChange:t=>B(t.target.value)})]}),e.jsxs(T,{sx:{p:2},children:[e.jsx(O,{sx:{position:"relative"},direction:"row",children:e.jsxs(S,{variant:"overline",children:["Assistant Model",e.jsx("span",{style:{color:"red"},children:" *"})]})}),e.jsx(Me,{name:M,options:st,onSelect:t=>E(t),value:M??"choose an option"},M)]}),e.jsxs(T,{sx:{p:2},children:[e.jsx(O,{sx:{position:"relative"},direction:"row",children:e.jsxs(S,{variant:"overline",children:["OpenAI Credential",e.jsx("span",{style:{color:"red"},children:" *"})]})}),e.jsx(ze,{data:F?{credential:F}:{},inputParam:{label:"Connect Credential",name:"credential",type:"credential",credentialNames:["openAIApi"]},onSelect:t=>U(t)},F)]}),e.jsxs(T,{sx:{p:2},children:[e.jsx(O,{sx:{position:"relative"},direction:"row",children:e.jsxs(S,{variant:"overline",children:["Assistant Instruction",e.jsx(_,{style:{marginLeft:10},title:"The system instructions that the assistant uses. The maximum length is 32768 characters."})]})}),e.jsx(K,{id:"assistantInstructions",type:"string",fullWidth:!0,placeholder:"You are a personal math tutor. When asked a question, write and run Python code to answer the question.",multiline:!0,rows:3,value:Y,name:"assistantInstructions",onChange:t=>L(t.target.value)})]}),e.jsxs(T,{sx:{p:2},children:[e.jsx(O,{sx:{position:"relative"},direction:"row",children:e.jsxs(S,{variant:"overline",children:["Assistant Tools",e.jsx(_,{style:{marginLeft:10},title:"A list of tool enabled on the assistant. There can be a maximum of 128 tools per assistant."})]})}),e.jsx(pe,{name:JSON.stringify(z),options:[{label:"Code Interpreter",name:"code_interpreter"},{label:"Retrieval",name:"retrieval"}],onSelect:t=>R(t?JSON.parse(t):[]),value:z??"choose an option"},JSON.stringify(z))]}),e.jsxs(T,{sx:{p:2},children:[e.jsx(O,{sx:{position:"relative"},direction:"row",children:e.jsxs(S,{variant:"overline",children:["Knowledge Files",e.jsx(_,{style:{marginLeft:10},title:"Allow assistant to use the content from uploaded files for retrieval and code interpreter. MAX: 20 files"})]})}),e.jsx("div",{style:{display:"flex",flexDirection:"row"},children:G.map((t,a)=>e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",width:"max-content",height:"max-content",borderRadius:15,background:"rgb(254,252,191)",paddingLeft:15,paddingRight:15,paddingTop:5,paddingBottom:5,marginRight:10},children:[e.jsx("span",{style:{color:"rgb(116,66,16)",marginRight:10},children:t.filename}),e.jsx(Je,{sx:{height:15,width:15,p:0},onClick:()=>De(t.id),children:e.jsx(C,{})})]},a))}),e.jsx(ue,{fileType:"*",onChange:t=>Z(t),value:X??"Choose a file to upload"},X)]})]}),e.jsxs(Be,{children:[s.type==="EDIT"&&e.jsx(H,{color:"secondary",variant:"contained",onClick:()=>be(),children:"Sync"}),s.type==="EDIT"&&e.jsx(H,{color:"error",variant:"contained",onClick:()=>Ae(),children:"Delete"}),e.jsx(H,{disabled:!(M&&F),variant:"contained",onClick:()=>s.type==="ADD"?fe():je(),children:s.confirmButtonName})]}),e.jsx(he,{show:xe,dialogProps:ge,onCancel:()=>P(!1),onDelete:()=>se(),onDeleteBoth:()=>se(!0)}),ee&&e.jsx(me,{open:ee})]}):null;return ce.createPortal(ve,j)};nt.propTypes={show:o.bool,dialogProps:o.object,onCancel:o.func,onConfirm:o.func};export{nt as A,me as B,ue as F,pe as M,J as a};
