import{P as C,u as X,a as n,S as ce,H as L,j as e,D as K,b as Q,ad as J,c as Z,B as T,T as z,d as ee,q as V,k as ae,l as te,A as de,E as he,M as xe,G as ue,I as pe,X as me,p as be,v as je,w as fe,x as ge,n as O,m as l,y as ye,C as ve,z as P,a6 as De,a7 as we}from"./index-BfWzQ8Ph.js";import{b as I,O as W,D as Ce,a as se,B as g,u as Ve,S as q}from"./useApi-DNUtCWFw.js";import{u as ie,C as re,a as Te,T as Se,I as ke,c as Y}from"./useNotifier-DEurOnvN.js";import{D as Ae}from"./Dropdown-CU36pm9t.js";import{C as _}from"./CodeEditor-DGLnL6g5.js";import{B as U}from"./ButtonGroup-CLQF0vSA.js";import"./Autocomplete-BBd9zFIQ.js";const Be=()=>I.get("/variables"),Ee=r=>I.post("/variables",r),Ie=(r,i)=>I.put(`/variables/${r}`,i),Ne=r=>I.delete(`/variables/${r}`),E={getAllVariables:Be,createVariable:Ee,updateVariable:Ie,deleteVariable:Ne},$e="/assets/variables_empty-BRQPFrO4.svg",Re=[{label:"Static",name:"static",description:"Variable value will be read from the value entered below"},{label:"Runtime",name:"runtime",description:"Variable value will be read from .env file"}],le=({show:r,dialogProps:i,onCancel:x,onConfirm:b})=>{const A=document.getElementById("portal"),u=X();ie();const h=(...s)=>u(ae(...s)),y=(...s)=>u(te(...s)),[j,p]=n.useState(""),[v,D]=n.useState(""),[o,w]=n.useState("static"),[f,S]=n.useState("ADD"),[N,k]=n.useState({});n.useEffect(()=>(i.type==="EDIT"&&i.data?(p(i.data.name),D(i.data.value),w(i.data.type),S("EDIT"),k(i.data)):i.type==="ADD"&&(p(""),D(""),w("static"),S("ADD"),k({})),()=>{p(""),D(""),w("static"),S("ADD"),k({})}),[i]),n.useEffect(()=>(u(r?{type:ce}:{type:L}),()=>u({type:L})),[r,u]);const $=async()=>{var s,m,a;try{const t={name:j,value:v,type:o},c=await E.createVariable(t);c.data&&(h({message:"New Variable added",options:{key:new Date().getTime()+Math.random(),variant:"success",action:d=>e.jsx(g,{style:{color:"white"},onClick:()=>y(d),children:e.jsx(V,{})})}}),b(c.data.id))}catch(t){const c=typeof t=="string"?t:((s=t.response)==null?void 0:s.data)||`${(m=t.response)==null?void 0:m.status}: ${(a=t.response)==null?void 0:a.statusText}`;h({message:`Failed to add new Variable: ${c}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:d=>e.jsx(g,{style:{color:"white"},onClick:()=>y(d),children:e.jsx(V,{})})}}),x()}},R=async()=>{var s,m,a;try{const t={name:j,value:v,type:o},c=await E.updateVariable(N.id,t);c.data&&(h({message:"Variable saved",options:{key:new Date().getTime()+Math.random(),variant:"success",action:d=>e.jsx(g,{style:{color:"white"},onClick:()=>y(d),children:e.jsx(V,{})})}}),b(c.data.id))}catch(t){const c=((s=t.response)==null?void 0:s.data)||`${(m=t.response)==null?void 0:m.status}: ${(a=t.response)==null?void 0:a.statusText}`;h({message:`Failed to save Variable: ${c}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:d=>e.jsx(g,{style:{color:"white"},onClick:()=>y(d),children:e.jsx(V,{})})}}),x()}},M=r?e.jsxs(K,{fullWidth:!0,maxWidth:"sm",open:r,onClose:x,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(Q,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx("div",{style:{width:50,height:50,marginRight:10,borderRadius:"50%",backgroundColor:"white"},children:e.jsx(J,{style:{width:"100%",height:"100%",padding:7,borderRadius:"50%",objectFit:"contain"}})}),i.type==="ADD"?"Add Variable":"Edit Variable"]})}),e.jsxs(Z,{children:[e.jsxs(T,{sx:{p:2},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(z,{children:["Variable Name",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(W,{size:"small",sx:{mt:1},type:"string",fullWidth:!0,onChange:s=>p(s.target.value),value:j??""},"variableName")]}),e.jsxs(T,{sx:{p:2},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(z,{children:["Type",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(Ae,{name:"variableType",options:Re,onSelect:s=>w(s),value:o??"choose an option"},o)]}),o==="static"&&e.jsxs(T,{sx:{p:2},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(z,{children:["Value",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(W,{size:"small",sx:{mt:1},type:"string",fullWidth:!0,onChange:s=>D(s.target.value),value:v??""},"variableValue")]})]}),e.jsx(Ce,{children:e.jsx(se,{disabled:!j||!o||o==="static"&&!v,variant:"contained",onClick:()=>f==="ADD"?$():R(),children:i.confirmButtonName})}),e.jsx(re,{})]}):null;return ee.createPortal(M,A)};le.propTypes={show:C.bool,dialogProps:C.object,onCancel:C.func,onConfirm:C.func};const Me=`{
    overrideConfig: {
        vars: {
            var1: 'abc'
        }
    }
}`,ne=({show:r,onCancel:i})=>{const x=document.getElementById("portal"),b=r?e.jsxs(K,{onClose:i,open:r,fullWidth:!0,maxWidth:"sm","aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(Q,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:"How To Use Variables"}),e.jsxs(Z,{children:[e.jsx("p",{style:{marginBottom:"10px"},children:"Variables can be used in Custom Tool Function with the $ prefix."}),e.jsx(_,{disabled:!0,value:"$vars.<variable-name>",height:"50px",theme:"dark",lang:"js",basicSetup:{highlightActiveLine:!1,highlightActiveLineGutter:!1}}),e.jsx("p",{style:{marginBottom:"10px"},children:"If variable type is Static, the value will be retrieved as it is. If variable type is Runtime, the value will be retrieved from .env file."}),e.jsxs("p",{style:{marginBottom:"10px"},children:["You can also override variable values in API overrideConfig using ",e.jsx("b",{children:"vars"}),":"]}),e.jsx(_,{disabled:!0,value:Me,height:"170px",theme:"dark",lang:"js",basicSetup:{highlightActiveLine:!1,highlightActiveLineGutter:!1}}),e.jsxs("p",{children:["Read more from"," ",e.jsx("a",{target:"_blank",rel:"noreferrer",href:"https://docs.flowiseai.com/using-flowise/variables",children:"docs"})]})]})]}):null;return ee.createPortal(b,x)};ne.propTypes={show:C.bool,onCancel:C.func};const We=()=>{const r=de(),i=he(a=>a.customization),x=X();ie();const b=(...a)=>x(ae(...a)),A=(...a)=>x(te(...a)),[u,h]=n.useState(!1),[y,j]=n.useState({}),[p,v]=n.useState([]),[D,o]=n.useState(!1),{confirm:w}=Te(),f=Ve(E.getAllVariables),[S,N]=n.useState(""),k=a=>{N(a.target.value)};function $(a){return a.name.toLowerCase().indexOf(S.toLowerCase())>-1}const R=()=>{j({type:"ADD",cancelButtonName:"Cancel",confirmButtonName:"Add",data:{}}),h(!0)},M=a=>{j({type:"EDIT",cancelButtonName:"Cancel",confirmButtonName:"Save",data:a}),h(!0)},s=async a=>{var d,F,H;const t={title:"Delete",description:`Delete variable ${a.name}?`,confirmButtonName:"Delete",cancelButtonName:"Cancel"};if(await w(t))try{(await E.deleteVariable(a.id)).data&&(b({message:"Variable deleted",options:{key:new Date().getTime()+Math.random(),variant:"success",action:G=>e.jsx(g,{style:{color:"white"},onClick:()=>A(G),children:e.jsx(V,{})})}}),m())}catch(B){const G=((d=B.response)==null?void 0:d.data)||`${(F=B.response)==null?void 0:F.status}: ${(H=B.response)==null?void 0:H.statusText}`;b({message:`Failed to delete Variable: ${G}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:oe=>e.jsx(g,{style:{color:"white"},onClick:()=>A(oe),children:e.jsx(V,{})})}})}},m=()=>{h(!1),f.request()};return n.useEffect(()=>{f.request()},[]),n.useEffect(()=>{f.data&&v(f.data)},[f.data]),e.jsxs(e.Fragment,{children:[e.jsxs(xe,{sx:{background:i.isDarkMode?r.palette.common.black:""},children:[e.jsx(q,{flexDirection:"row",children:e.jsx(T,{sx:{flexGrow:1},children:e.jsxs(ue,{disableGutters:!0,style:{margin:1,padding:1,paddingBottom:10,display:"flex",justifyContent:"space-between",width:"100%"},children:[e.jsx("h1",{children:"Variables "}),e.jsx(Se,{size:"small",sx:{display:{xs:"none",sm:"block"},ml:3},variant:"outlined",placeholder:"Search variable name",onChange:k,InputProps:{startAdornment:e.jsx(ke,{position:"start",children:e.jsx(pe,{})})}}),e.jsx(T,{sx:{flexGrow:1}}),e.jsx(g,{variant:"outlined",sx:{mr:2},onClick:()=>o(!0),children:"How To Use"}),e.jsx(U,{sx:{maxHeight:40},disableElevation:!0,variant:"contained","aria-label":"outlined primary button group",children:e.jsx(U,{disableElevation:!0,"aria-label":"outlined primary button group",children:e.jsx(se,{variant:"contained",sx:{color:"white",mr:1,height:37},onClick:R,startIcon:e.jsx(me,{}),children:"Add Variable"})})})]})})}),p.length===0&&e.jsxs(q,{sx:{alignItems:"center",justifyContent:"center"},flexDirection:"column",children:[e.jsx(T,{sx:{p:2,height:"auto"},children:e.jsx("img",{style:{objectFit:"cover",height:"30vh",width:"auto"},src:$e,alt:"VariablesEmptySVG"})}),e.jsx("div",{children:"No Variables Yet"})]}),p.length>0&&e.jsx(be,{component:je,children:e.jsxs(fe,{sx:{minWidth:650},"aria-label":"simple table",children:[e.jsx(ge,{children:e.jsxs(O,{children:[e.jsx(l,{children:"Name"}),e.jsx(l,{children:"Value"}),e.jsx(l,{children:"Type"}),e.jsx(l,{children:"Last Updated"}),e.jsx(l,{children:"Created"}),e.jsx(l,{children:" "}),e.jsx(l,{children:" "})]})}),e.jsx(ye,{children:p.filter($).map((a,t)=>e.jsxs(O,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(l,{component:"th",scope:"row",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx("div",{style:{width:25,height:25,marginRight:10,borderRadius:"50%"},children:e.jsx(J,{style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"contain"}})}),a.name]})}),e.jsx(l,{children:a.value}),e.jsx(l,{children:e.jsx(ve,{color:a.type==="static"?"info":"secondary",size:"small",label:a.type})}),e.jsx(l,{children:P(a.updatedDate).format("DD-MMM-YY")}),e.jsx(l,{children:P(a.createdDate).format("DD-MMM-YY")}),e.jsx(l,{children:e.jsx(Y,{title:"Edit",color:"primary",onClick:()=>M(a),children:e.jsx(De,{})})}),e.jsx(l,{children:e.jsx(Y,{title:"Delete",color:"error",onClick:()=>s(a),children:e.jsx(we,{})})})]},t))})]})})]}),e.jsx(le,{show:u,dialogProps:y,onCancel:()=>h(!1),onConfirm:m}),e.jsx(ne,{show:D,onCancel:()=>o(!1)}),e.jsx(re,{})]})};export{We as default};
